import S,{useRef as H,useState as U,useEffect as Q,useLayoutEffect as W,forwardRef as X}from"react";var E=e=>{if(!e)return;let t=_(e);return e.innerText.at(t-1)},w=({mentionClassname:e,editorEl:t,highlightEl:n,value:r,label:s,trigger:i})=>{let c=document.createElement("span");c.className=e,c.setAttribute("trigger",i),c.setAttribute("value",r),c.contentEditable="false",c.innerText=s,L(c,n);let p=document.createTextNode("\xA0");L(p,c),t.removeChild(n),n.parentNode?.removeChild(n),R(t),y(t)},K=(e,t)=>{let n=document.createTextNode(t.innerText);L(n,t),t.parentNode?t.parentNode.removeChild(t):e.removeChild(t)},A=e=>{let t=e.childNodes,n=t.length;for(let r=n;r>0;r--){let s=t[r];if(s?.nodeName==="#text")return;s?.nodeName==="BR"&&s.parentNode?.removeChild(s)}},F=e=>{if(!e)return;let t=e.getElementsByTagName("font");if(t.length){for(let n=0;n<t.length;n++){let r=t[n].innerText,s=document.createTextNode(r);t[n].parentNode?.appendChild(s),t[n].parentNode?.removeChild(t[n])}y(e)}},G=(e,t)=>{let n=e.childNodes.length-1,r;for(let s=0;s<=n;s++){let i=e.childNodes[s];if(i.nodeName!=="#text"&&(r=i),i===t)break}return r},O=(e,t)=>{if(!t)return e.childNodes[e.childNodes.length-1];let n=e.childNodes.length-1,r;for(let s=0;s<=n&&(r=e.childNodes[s],r!==t);s++);return r},_=e=>{let t=0;if(window.getSelection){var n=window.getSelection()?.getRangeAt(0);if(!n)return t;var r=n.cloneRange();r.selectNodeContents(e),r.setEnd(n.endContainer,n.endOffset),t=r.toString().length}return t},P=(e,t)=>{let r=window.getSelection()?.anchorNode;if(!r)return;let s=_(e),i=0;for(let T=0;T<e.childNodes.length;T++){let d=e.childNodes[T];if(d===r)break;d.innerText?i+=d.innerText.length:i+=d.nodeValue?.length||0}if(r===e||i===s){s===0&&e.firstChild?e.insertBefore(t,e.firstChild):e.appendChild(t);return}let c;e.firstChild===r?c=s:c=s-i;let p=document.createTextNode(r.nodeValue?.substring(0,c)||""),b=document.createTextNode(r.nodeValue?.substring(c)||""),o=r.nextSibling;r.parentNode?.removeChild(r),o?(e.insertBefore(b,o),e.insertBefore(t,b),e.insertBefore(p,t)):(e.appendChild(p),e.appendChild(t),e.appendChild(b))},L=(e,t)=>{t.parentNode?.insertBefore(e,t.nextSibling)},y=e=>{let t=window.getSelection(),n=e||t?.anchorNode;n&&t?.collapse(n,n.childNodes.length)},R=e=>{let t=G(e);t?.scrollIntoView&&t.scrollIntoView()};var j=e=>{let t=/(<[^>]+>)([^<]+)<\/[^>]+>/g;return e.replace(/&nbsp;/g," ").replace(t,(r,s,i)=>{let c=/trigger="(.)"/,p=/value="([^"]+)"/,b=s.match(c),o=s.match(p);if(!b||!o)return i;let T=b[1],d=o[1];return`__${T}[${i}](${d})__ `}).replace(/<[^>]+>/g," ")};(function(){if(!document.getElementById("2d76d2ce1c48b868ea7bbaf5c310ae464f67278ef49d495dbb8ac1501a5660bd")){var e=document.createElement("style");e.id="2d76d2ce1c48b868ea7bbaf5c310ae464f67278ef49d495dbb8ac1501a5660bd",e.textContent=`.react-mentionable-suggestions {
  position: relative;
  padding: 1rem;
  border: 1px solid #ccc;
}

.react-mentionable-input {
  padding: 1rem;
  border: 1px solid #ccc;
}
`,document.head.appendChild(e)}})();var Y=X((e,t)=>{let{placeHolder:n,inputClass:r,suggestionsClass:s,mentions:i,onChange:c,renderSuggestion:p,disabled:b}=e,o=H(),[T,d]=U(!1),[B,D]=U([]),q=i.map(l=>l.trigger),h=H(!1),u=H(),v=H([]),a=H(),V=l=>{!o.current||!a.current||(w({mentionClassname:i.find(k=>k.trigger===u.current)?.mentionClassname||"",trigger:u.current||"",value:l.value,editorEl:o.current,label:l.label,highlightEl:a.current}),d(!1),h.current=!1)};return Q(()=>{b&&o.current&&(o.current.setAttribute("contenteditable","false"),o.current.style.opacity="0.5")},[b]),W(()=>{if(!o?.current||typeof document>"u")return;let l=x=>{if(!o.current)return;F(o.current);let m=x.key||E(o.current);if(h.current&&m==="Tab"||m===" "){let g=O(o.current);if(!g)return;let f=g?.nodeValue?.replace(u.current||"","").toLowerCase()||"";a.current&&v.current.length===1&&h.current||v.current.map(N=>N.label).includes(f)?w({mentionClassname:i.find(N=>N.trigger===u.current)?.mentionClassname||"",trigger:u.current||"",value:v.current[0].value,editorEl:o.current,label:v.current[0].label,highlightEl:a.current}):h.current&&v.current.length!==1&&(K(o.current,a.current),y(o.current)),h.current=!1,d(!1)}else if(m==="Backspace"){x.preventDefault();let f=window.getSelection()?.anchorNode;if(!f)return;let N=f.childNodes.length||0,M=f.childNodes[N-1];M?.nodeValue===""&&M?.parentNode?.removeChild(M),A(f),A(o.current),a.current?.innerText.length===1&&(x.preventDefault(),d(!1),h.current=!1)}else if(h.current&&m!==u.current){let g=a.current?.innerText||"",f=g.lastIndexOf(u.current||""),N=g.substr(f+1).replace(/[^\w]/,""),M=new RegExp(N,"i"),I=i.find(C=>C.trigger===u.current),$=i.find(C=>C.trigger===u.current)?.suggestions;Array.isArray(I?.suggestions)?$&&(v.current=$.filter(C=>M.test(C.label)),D(v.current)):I?.suggestions(N).then(C=>{v.current=C.filter(z=>M.test(z.label)),D(v.current)})}c({text:o.current.innerText,markup:j(o.current.innerHTML)})},k=x=>{let m=x.key||E(o.current);if(!(!m||!o.current||typeof document>"u")){if(m==="Enter"){x.preventDefault();let g=document.createElement("br"),f=document.createTextNode("\u200B");P(o.current,g),L(f,g),y(o.current)}else if(m==="Tab")x.preventDefault();else if(q.includes(m)){if(h.current){x.preventDefault();return}u.current=m,h.current=!0,a.current=document.createElement("span"),a.current.className=`${i.find(g=>g.trigger===u.current)?.highlightClassName}`,a.current.innerText=u.current,a.current.setAttribute("contentEditable","true"),P(o.current,a.current),d(!0),y(a.current),R(o.current),x.preventDefault()}}};o.current.addEventListener("keydown",k),o.current.addEventListener("keyup",l)},[]),S.createElement("div",{className:"react-mentionable"},S.createElement("div",{className:"react-mentionable-editor-container"},S.createElement("div",{placeholder:n,className:`react-mentionable-input ${r}`,ref:l=>{o.current=l,typeof t=="function"?t(l):t&&t.current},contentEditable:!0})),T&&S.createElement("div",{className:`react-mentionable-suggestions ${s}`},B&&B.map(l=>p?p(l,V):S.createElement("div",{onClick:()=>V(l),key:l.label,className:"react-mentionable-suggestion"},l.label))))}),Z=Y;export{Z as default};
